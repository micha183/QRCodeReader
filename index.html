<!DOCTYPE html>
<html>
  <head>
    <title>QR Code Scanner</title>
    <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
  </head>
  <body>
    <video id="video" width="320" height="240" autoplay></video>
    <canvas id="canvas" width="320" height="240"></canvas>
    <button id="scan">Scan QR Code</button>
    <div id="output"></div>

    <script>
      const video = document.getElementById('video');
      const canvas = document.getElementById('canvas');
      const scanButton = document.getElementById('scan');
      const output = document.getElementById('output');

      function onSuccess(stream) {
        video.srcObject = stream;

        const track = stream.getVideoTracks()[0];
        const imageCapture = new ImageCapture(track);

        function scanQRCode() {
          imageCapture.grabFrame()
            .then(imageBitmap => {
              canvas.getContext('2d').drawImage(imageBitmap, 0, 0, canvas.width, canvas.height);

              const imageData = canvas.getContext('2d').getImageData(0, 0, canvas.width, canvas.height);
              const code = jsQR(imageData.data, imageData.width, imageData.height);

              if (code) {
                output.textContent = code.data;
              }

              requestAnimationFrame(scanQRCode);
            })
            .catch(error => {
              console.log(error);
            });
        }

        scanButton.addEventListener('click', () => {
          scanButton.style.display = 'none';
          requestAnimationFrame(scanQRCode);
        });
      }

      function onError(error) {
        console.log(error);
      }

      navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(onSuccess)
        .catch(onError);
    </script>
  </body>
</html>
